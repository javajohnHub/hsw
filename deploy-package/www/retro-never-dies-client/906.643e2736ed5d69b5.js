"use strict";(self.webpackChunkretro_never_dies_client=self.webpackChunkretro_never_dies_client||[]).push([[906],{4906:(E,w,h)=>{h.r(w),h.d(w,{GamesWheelComponent:()=>T});var v=h(2881),t=h(1360),M=h(7643),G=h(671);const P=["gamesCanvas"];function k(o,p){if(1&o&&(t.j41(0,"div",19),t.EFF(1),t.k0s()),2&o){const n=p.$implicit;t.R7$(),t.SpI(" ",n.name," ")}}function O(o,p){1&o&&(t.j41(0,"div",20),t.EFF(1,"All games have been chosen!"),t.k0s())}function y(o,p){if(1&o&&(t.j41(0,"div",21),t.EFF(1),t.k0s()),2&o){const n=t.XpG();t.R7$(),t.JRh(n.gamesFeedback)}}function F(o,p){if(1&o){const n=t.RV6();t.j41(0,"div",22)(1,"span",23),t.EFF(2),t.k0s(),t.j41(3,"button",24),t.bIt("click",function(){const a=t.eBV(n).$implicit,i=t.XpG();return t.Njj(i.returnGameToWheel(a))}),t.EFF(4,"Return to Wheel"),t.k0s()()}if(2&o){const n=p.$implicit;t.R7$(2),t.JRh(n.name)}}function W(o,p){1&o&&(t.j41(0,"div",20),t.EFF(1,"No games chosen yet"),t.k0s())}let T=(()=>{class o{http;authService;gamesCanvasRef;games=[];availableGames=[];chosenGames=[];selectedGame=null;spinning=!1;angle=0;gamesFeedback="";faviconImg=null;currentWeek=1;currentSeasonId=null;constructor(n,e){this.http=n,this.authService=e}ngOnInit(){}ngAfterViewInit(){this.loadFavicon(),this.loadActiveWeek(),this.loadCurrentSeason(),this.loadGames(),setTimeout(()=>this.resizeCanvas(),50)}onWindowResize(){this.resizeCanvas()}resizeCanvas(){try{const n=this.gamesCanvasRef?.nativeElement;if(!n)return;const e=window.devicePixelRatio||1,i=(n.parentElement||n).getBoundingClientRect(),s=Math.max(200,Math.floor(window.innerWidth-40)),r=Math.floor(i.width||0),m=Math.floor(i.height||r||0),c=Math.max(200,Math.min(Math.min(r,m),s));n.width=Math.floor(c*e),n.height=Math.floor(c*e),n.style.width=`${c}px`,n.style.height=`${c}px`;const g=n.getContext("2d");g&&g.setTransform(e,0,0,e,0,0),this.drawGamesWheel()}catch(n){console.warn("resizeCanvas error",n)}}loadFavicon(){this.faviconImg=new Image,this.faviconImg.onload=()=>{this.drawGamesWheel()},this.faviconImg.src="favicon.ico"}loadGames(){this.http.get("http://localhost:4000/games").subscribe({next:n=>{console.log("Games loaded:",n),Array.isArray(n)&&(this.games=n,this.updateGameLists(),this.drawGamesWheel())},error:n=>{console.error("Error loading games:",n),this.games=[{id:1,name:"Street Fighter 6",category:"Fighting"},{id:2,name:"Tekken 8",category:"Fighting"},{id:3,name:"Guilty Gear Strive",category:"Fighting"},{id:4,name:"Mortal Kombat 1",category:"Fighting"},{id:5,name:"Super Smash Bros Ultimate",category:"Platform Fighter"}],this.updateGameLists(),this.drawGamesWheel()}})}updateGameLists(){const n=this.games.filter(a=>a.assignedWeek===this.currentWeek&&(!this.currentSeasonId||a.assignedSeason===this.currentSeasonId)),e=n.length>0?n:this.games;this.availableGames=e.filter(a=>!a.isChosen),this.chosenGames=e.filter(a=>a.isChosen)}truncateText(n,e,a,i=9){const s="...";if(e.length>i)return e.slice(0,i)+s;if(n.measureText(e).width<=a)return e;let r=e;for(;r.length>0;){const m=r+s;if(n.measureText(m).width<=a)return m;r=r.slice(0,-1)}return s}loadActiveWeek(){this.http.get("http://localhost:4000/active-week").subscribe({next:n=>{n&&"number"==typeof n.week&&(this.currentWeek=n.week,this.updateGameLists(),this.drawGamesWheel())},error:()=>{try{const n=localStorage.getItem("currentActiveWeek");n&&(this.currentWeek=parseInt(n,10)||1,this.updateGameLists(),this.drawGamesWheel())}catch{}}})}loadCurrentSeason(){this.http.get("http://localhost:4000/seasons").subscribe({next:n=>{const e=Array.isArray(n)?n.find(a=>"active"===a.status):null;e&&(this.currentSeasonId=e.id,this.updateGameLists(),this.drawGamesWheel())},error:()=>{}})}drawGamesWheel(){const n=this.gamesCanvasRef&&this.gamesCanvasRef.nativeElement||document.querySelector("canvas.games-canvas");if(!n)return;const e=n.getContext("2d");if(!e)return;const a=n.getBoundingClientRect(),i=Math.max(0,Math.min(a.width,a.height||a.width)),s=i/2,r=Math.max(10,s-10);e.clearRect(0,0,i,i);const m=this.availableGames,c=m.length;if(0===c)return e.beginPath(),e.arc(s,s,r,0,2*Math.PI),e.fillStyle="#666",e.fill(),e.strokeStyle="#fff",e.lineWidth=2,e.stroke(),e.textAlign="center",e.font="bold 1.5rem Orbitron, Arial",e.fillStyle="#fff",void e.fillText("No Games",s,s);const g=2*Math.PI/c;let f=this.selectedGame?m.findIndex(l=>l.name===this.selectedGame):-1;for(let l=0;l<c;l++){const _=this.angle+l*g,I=_+g;e.beginPath(),e.moveTo(s,s),e.arc(s,s,r,_,I),e.closePath(),l===f?(e.fillStyle="#53fc19",e.globalAlpha=.95,e.fill(),e.globalAlpha=1,e.strokeStyle="#fff",e.lineWidth=8,e.stroke()):(e.fillStyle=l%2==0?"#53fc19":"#181a1b",e.globalAlpha=.85,e.fill(),e.globalAlpha=1,e.strokeStyle="#fff",e.lineWidth=2,e.stroke()),e.save(),e.translate(s,s),e.rotate(_+g/2),e.textAlign="right",e.font="bold 0.8rem Orbitron, Arial",e.fillStyle=l===f?"#181a1b":"#fff",e.shadowColor=l===f?"#53fc19":"#181a1b",e.shadowBlur=l===f?8:4;const x=m[l].name,b=r-25;if(x.length>9){const d=x.split(" ");if(d.length>1){const C=d.slice(0,Math.ceil(d.length/2)).join(" "),R=d.slice(Math.ceil(d.length/2)).join(" "),S=this.truncateText(e,C,b),A=this.truncateText(e,R,b);e.fillText(S,r-18,-4),e.fillText(A,r-18,12)}else{const C=this.truncateText(e,x,b);e.fillText(C,r-18,4)}}else{const d=this.truncateText(e,x,b);e.fillText(d,r-18,4)}e.restore()}e.save(),e.translate(s,s),e.rotate(this.angle),e.beginPath(),e.arc(0,0,40,0,2*Math.PI),e.fillStyle="#fff",e.fill(),e.strokeStyle="#53fc19",e.lineWidth=3,e.stroke(),this.faviconImg&&this.faviconImg.complete&&e.drawImage(this.faviconImg,-25,-25,50,50),e.restore(),e.save(),e.translate(s,20),e.beginPath(),e.moveTo(0,0),e.lineTo(-15,-25),e.lineTo(-5,-15),e.lineTo(5,-15),e.lineTo(15,-25),e.lineTo(0,0),e.closePath(),e.fillStyle="#fff",e.strokeStyle="#181a1b",e.lineWidth=2,e.shadowColor="#53fc19",e.shadowBlur=8,e.fill(),e.stroke(),e.restore()}spinGamesWheel(){if(this.spinning||0===this.availableGames.length)return;this.spinning=!0,this.gamesFeedback="Spinning for a game...";const n=Math.floor(Math.random()*this.availableGames.length),e=2*Math.PI/this.availableGames.length,a=3*Math.PI/2-(e*n+e/2);let i=this.angle,s=performance.now(),m=6*Math.PI+a;const c=3e3,g=f=>{let u=f-s;if(u>c&&(u=c),this.angle=i+u/c*(m-i),this.drawGamesWheel(),u<c)requestAnimationFrame(g);else{this.angle=m%(2*Math.PI),this.drawGamesWheel();const l=this.availableGames[n];this.selectedGame=l.name,this.spinning=!1,l.isChosen=!0,this.updateGameLists(),this.http.put(`http://localhost:4000/games/${l.id}`,l).subscribe({next:()=>{this.gamesFeedback=`${l.name} has been chosen!`,this.drawGamesWheel(),setTimeout(()=>{this.gamesFeedback=""},3e3)},error:()=>{this.gamesFeedback="Error saving game selection."}})}};requestAnimationFrame(g)}returnGameToWheel(n){n.isChosen=!1,this.updateGameLists(),this.http.put(`http://localhost:4000/games/${n.id}`,n).subscribe({next:()=>{this.drawGamesWheel(),this.gamesFeedback=`${n.name} returned to wheel`,setTimeout(()=>{this.gamesFeedback=""},2e3)},error:()=>{this.gamesFeedback="Error returning game to wheel."}})}resetChosenGames(){confirm("Reset all chosen games back to the wheel?")&&(this.games.forEach(n=>n.isChosen=!1),this.updateGameLists(),this.http.post("http://localhost:4000/games/reset",{}).subscribe({next:()=>{this.drawGamesWheel(),this.gamesFeedback="All games reset to wheel",setTimeout(()=>{this.gamesFeedback=""},2e3)},error:()=>{this.gamesFeedback="Error resetting games."}}))}static \u0275fac=function(e){return new(e||o)(t.rXU(M.Qq),t.rXU(G.u))};static \u0275cmp=t.VBU({type:o,selectors:[["app-games-wheel"]],viewQuery:function(e,a){if(1&e&&t.GBs(P,5),2&e){let i;t.mGM(i=t.lsd())&&(a.gamesCanvasRef=i.first)}},hostBindings:function(e,a){1&e&&t.bIt("resize",function(){return a.onWindowResize()},!1,t.tSv)},decls:28,vars:9,consts:[["gamesCanvas",""],[1,"games-bg"],[1,"games-title"],[1,"games-main-layout"],[1,"games-left-column"],[1,"games-image-wheel-row"],[1,"games-container"],["width","350","height","350",1,"games-canvas",3,"click"],[1,"games-panel-compact"],[1,"available-games-compact"],["class","available-game-compact",4,"ngFor","ngForOf"],["class","no-games",4,"ngIf"],[1,"games-right-column"],[1,"selected-game","animate-pop"],[1,"selected-name"],["class","games-feedback",4,"ngIf"],[1,"games-panel"],[1,"chosen-games-list"],["class","chosen-game-item",4,"ngFor","ngForOf"],[1,"available-game-compact"],[1,"no-games"],[1,"games-feedback"],[1,"chosen-game-item"],[1,"game-name"],[1,"return-btn",3,"click"]],template:function(e,a){if(1&e){const i=t.RV6();t.j41(0,"div",1)(1,"h1",2),t.EFF(2),t.k0s(),t.j41(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6)(7,"canvas",7,0),t.bIt("click",function(){return t.eBV(i),t.Njj(a.spinGamesWheel())}),t.k0s()()(),t.j41(9,"div",8)(10,"h2"),t.EFF(11),t.k0s(),t.j41(12,"div",9),t.DNE(13,k,2,1,"div",10)(14,O,2,0,"div",11),t.k0s()()(),t.j41(15,"div",12)(16,"div",13)(17,"h2"),t.EFF(18,"Selected Game:"),t.k0s(),t.j41(19,"div",14),t.EFF(20),t.k0s(),t.DNE(21,y,2,1,"div",15),t.k0s(),t.j41(22,"div",16)(23,"h2"),t.EFF(24,"Chosen Games"),t.k0s(),t.j41(25,"div",17),t.DNE(26,F,5,1,"div",18)(27,W,2,0,"div",11),t.k0s()()()()()}2&e&&(t.R7$(2),t.Lme("Available Games: ",a.availableGames.length," | Chosen Games: ",a.chosenGames.length,""),t.R7$(9),t.SpI("Available Games (",a.availableGames.length,")"),t.R7$(2),t.Y8G("ngForOf",a.availableGames),t.R7$(),t.Y8G("ngIf",0===a.availableGames.length),t.R7$(6),t.JRh(a.selectedGame||"No selection yet"),t.R7$(),t.Y8G("ngIf",a.gamesFeedback),t.R7$(5),t.Y8G("ngForOf",a.chosenGames),t.R7$(),t.Y8G("ngIf",0===a.chosenGames.length))},dependencies:[v.MD,v.Sq,v.bT],styles:[".games-bg[_ngcontent-%COMP%]{min-height:100vh;background:#181a1b;font-family:Orbitron,Arial Black,Arial,sans-serif;color:#fff;padding:20px}.games-title[_ngcontent-%COMP%]{text-align:center;font-size:2.5rem;font-weight:900;color:#ddd;text-shadow:2px 2px 0 #181a1b,0 0 12px #53fc19;margin:0 0 16px}.games-main-layout[_ngcontent-%COMP%]{display:flex;gap:20px;max-width:1400px;margin:0 auto;align-items:flex-start}.games-left-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;flex:1;max-width:600px}.games-right-column[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1;max-width:600px}.games-image-wheel-row[_ngcontent-%COMP%]{display:flex;gap:20px;align-items:center;margin-bottom:16px}.games-banner[_ngcontent-%COMP%]{margin-bottom:0}.games-img[_ngcontent-%COMP%]{max-width:400px;height:auto}.games-container[_ngcontent-%COMP%]{width:350px;aspect-ratio:1 / 1;margin-bottom:16px;display:flex;justify-content:center;align-items:center}.games-canvas[_ngcontent-%COMP%]{display:block;width:100%;height:100%;border-radius:50%;box-shadow:0 0 24px #53fc19,0 0 32px #181a1b inset;background:#fff}.games-btn-row[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:16px;margin:16px 0;flex-wrap:wrap}.games-btn[_ngcontent-%COMP%]{background:linear-gradient(135deg,#53fc19,#48e017);color:#181a1b;border:none;padding:12px 24px;border-radius:8px;font-weight:900;font-size:1rem;cursor:pointer;transition:all .3s ease;box-shadow:0 4px 12px #53fc194d}.games-btn[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 6px 16px #53fc1980}.games-btn[_ngcontent-%COMP%]:disabled{background:#333;color:#666;cursor:not-allowed;transform:none;box-shadow:none}.selected-game[_ngcontent-%COMP%]{background:#53fc1926;border:2px solid #53fc19;border-radius:12px;padding:20px 24px;margin:16px 0;text-align:center}.selected-game[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 8px;color:#ddd;font-size:1.4rem}.selected-game[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:1.1rem;color:#ddd}.games-lists[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:24px}.games-section[_ngcontent-%COMP%]{background:#ffffff0d;border-radius:12px;padding:20px;border:1px solid rgba(83,252,25,.3)}.games-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0 0 16px;color:#ddd;font-size:1.3rem;text-align:center}.games-list[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;max-height:400px;overflow-y:auto}.games-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:8px 12px;margin-bottom:4px;background:#ffffff1a;border-radius:6px;font-size:.95rem;border-left:3px solid #53fc19}.games-img-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}.games-wheel-col[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;left:-200px;top:150px}.games-panel[_ngcontent-%COMP%]{background:#181a1bf2;border-radius:18px;box-shadow:0 0 24px #53fc19,0 0 32px #181a1b inset;padding:20px 24px;margin:16px 0;color:#fff}.games-panel-compact[_ngcontent-%COMP%]{background:#181a1bf2;border-radius:18px;box-shadow:0 0 24px #53fc19,0 0 32px #181a1b inset;padding:16px 20px;margin:16px 0;color:#fff}.chosen-games-list[_ngcontent-%COMP%], .available-games-list[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:12px;margin-top:16px}.chosen-game-item[_ngcontent-%COMP%], .available-game-item[_ngcontent-%COMP%]{background:#53fc191a;border:1px solid #53fc19;border-radius:8px;padding:12px;display:flex;justify-content:space-between;align-items:center}.game-name[_ngcontent-%COMP%]{color:#ddd;font-weight:700;flex:1}.return-btn[_ngcontent-%COMP%]{background:#53fc19;color:#181a1b;border:none;padding:6px 12px;border-radius:4px;cursor:pointer;font-size:.9rem}.return-btn[_ngcontent-%COMP%]:hover{background:#45d915}.no-games[_ngcontent-%COMP%]{color:#666;font-style:italic;text-align:center;padding:20px;grid-column:1 / -1}.available-games-full-row[_ngcontent-%COMP%]{max-width:1400px;margin:24px auto 0}.games-panel-full[_ngcontent-%COMP%]{background:#181a1bf2;border-radius:18px;box-shadow:0 0 24px #53fc19,0 0 32px #181a1b inset;padding:24px 32px;color:#fff}.available-games-compact[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-top:16px}.available-game-compact[_ngcontent-%COMP%]{background:#53fc191a;border:1px solid #53fc19;border-radius:4px;padding:6px 8px;color:#ddd;font-weight:700;font-size:.8rem;text-align:center}@media (max-width: 900px){.games-flex[_ngcontent-%COMP%]{flex-direction:column;gap:16px}.games-panel[_ngcontent-%COMP%]{max-width:98vw}.games-container[_ngcontent-%COMP%]{width:98vw;aspect-ratio:1 / 1;max-width:400px}}@media (max-width: 768px){.games-main-layout[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.games-left-column[_ngcontent-%COMP%], .games-right-column[_ngcontent-%COMP%]{max-width:100%!important;width:100%!important;flex:none!important;margin:0 auto!important}.games-container[_ngcontent-%COMP%]{width:90vw!important;aspect-ratio:1 / 1!important;max-width:640px!important}.games-canvas[_ngcontent-%COMP%]{width:100%!important;height:100%!important;max-width:none!important}.games-btn-row[_ngcontent-%COMP%], .games-btn[_ngcontent-%COMP%]{width:100%!important}.games-btn[_ngcontent-%COMP%]{display:block;width:100%;box-sizing:border-box}.chosen-games-list[_ngcontent-%COMP%], .available-games-compact[_ngcontent-%COMP%]{grid-template-columns:1fr!important}.games-panel[_ngcontent-%COMP%], .games-panel-compact[_ngcontent-%COMP%]{padding:12px!important}}"]})}return o})()}}]);